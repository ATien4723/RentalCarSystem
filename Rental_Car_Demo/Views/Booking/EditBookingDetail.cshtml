@model Rental_Car_Demo.Models.Booking
@using Newtonsoft.Json
@using Microsoft.AspNetCore.Http
@{
    var userString = Context.Session.GetString("User");
    User user = null;
    if (!string.IsNullOrEmpty(userString))
    {
        user = JsonConvert.DeserializeObject<User>(userString);
    }
}

@{
    ViewData["Title"] = "BookACar";
    Layout = "~/Views/Shared/_LayoutRentCar.cshtml";
}

<style>
     .booking-details-card {
        background-color: #4e4e4e;
        color: white;
        padding: 20px 20px 20px 60px;
        margin: auto;
        width: 100%;
        max-width: 100%;
    }

    .booking-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

        .booking-header h3 {
            margin: 0;
        }

    .change-details-link {
        color: #ffffff;
        text-decoration: none;
    }

        .change-details-link i {
            margin-right: 5px;
        }

    .booking-info {
        list-style: disc;
        padding-left: 60px;
    }

        .booking-info li {
            margin: 10px 0;
        }

        .booking-info strong {
            font-weight: 400;
        }

    .text-myfont {
        font-weight: 500;
    }
</style>

<style>

    .looking {
        display: none;
    }

     .carousel-control-prev-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M5.25 0l-4 4 4 4 1.5-1.5-2.5-2.5 2.5-2.5-1.5-1.5z'/%3E%3C/svg%3E") !important;
        }

        .carousel-control-next-icon {
            background-image: url("data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23000' viewBox='0 0 8 8'%3E%3Cpath d='M2.75 0l-1.5 1.5 2.5 2.5-2.5 2.5 1.5 1.5 4-4-4-4z'/%3E%3C/svg%3E") !important;
        }

        .carousel-inner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            margin-left:20%;
        }

        .carousel-item {
            height: 350px;
        }


    .d-none {
        display: none;
    }

    .star {
        color: lightgray;
    }

    .filled {
        color: gold;
    }

    .half-filled {
        background: linear-gradient(90deg, gold 50%, lightgray 50%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
</style>


<div class="container mt-2 mb-2">
    <a asp-controller="Users" asp-action="LoginCus">Home</a> > Book car
    <h1>Booking Details</h1>
</div>

<div class="container row">
    <form asp-controller="Booking" asp-action="EditBookingDetail" method="post" id="Form" enctype="multipart/form-data" style="margin: 0; padding: 0;">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <div class=" row mt-3" >
            <div id="demo" class="col-5 carousel slide ms-4 mt-3" data-bs-ride="carousel">
                <!-- Indicators/dots -->
                <div class="col-2">
                    <button class="carousel-control-prev" style="margin-left: -0%;" type="button" data-bs-target="#demo" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                </div>
                <div class="col-8">
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="2"></button>
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="3"></button>
                    </div>

                    <!-- The slideshow/carousel -->
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <img id="frontImg" src="~/img/@(ViewBag.car.FrontImage)" alt="Front img">
                        </div>
                        <div class="carousel-item ">
                            <img id="backImg" src="~/img/@(ViewBag.car.BackImage)" alt="Back img">
                        </div>
                        <div class="carousel-item ">
                            <img id="leftImg" src="~/img/@(ViewBag.car.LeftImage)" alt="Left img">
                        </div>
                        <div class="carousel-item ">
                            <img id="rightImg" src="~/img/@(ViewBag.car.RightImage)" alt="Right img">
                        </div>
                    </div>
                </div>
                <!-- Left and right controls/icons -->
                <div class="col-2">
                    <button class="carousel-control-next" style="margin-right: -0%;" type="button" data-bs-target="#demo" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
                </div>
                
            </div>

            <div class="col-1">
            </div>

            <div class="col-4" style="margin-left:-2%;">
                <h2 class="fw-bold mt-1" id="CarName">@ViewBag.car.Name</h2>
                <div class=" mt-2 fs-5">
                <ul class="row mt-2 fs-6 disc">
                    <li>
                        <label style="font-weight: 500;">From: @ViewBag.startDate.ToString("dd/MM/yyyy - HH:mm tt")</label>
                    </li>
                    <li>
                        <label style="font-weight: 500;">To: @ViewBag.endDate.ToString("dd/MM/yyyy - HH:mm tt")</label>
                    </li>
                </ul>
                </div>
                <div class="row mt-2 fs-6">
                    <label style="font-weight: 650;">Number of days: @Math.Round((double)ViewBag.NumberOfDays.TotalDays, 0)</label>
                </div>
                <div class="row mt-2 fs-6">
                    <label style="font-weight: 650;">Base price: @ViewBag.car.BasePrice.ToString("0.##") k/day</label>
                </div>
                <div class="row mt-2 fs-6">
                    <label style="font-weight: 650;">Total: @ViewBag.Total.ToString("0,0 VND")</label>
                </div>
                <div class="row mt-2 fs-6">
                    <label style="font-weight: 650;">Deposit: @ViewBag.car.Deposit.ToString("0,0 VND")</label>
                </div>
                <div class="row mt-2 fs-5">
                    <label class="col-4 fw-bold">Booking No.</label>
                    <label class="col-5 fw-bold">@Model.BookingNo</label>
                </div>
                <div class="row mt-2 fs-5">
                    <label class="col-4 fw-bold">Booking status:</label>
                    @if (Model.Status == 0)
                    {
                        <label class="col-5 fw-bold text-primary">Available</label>
                    }
                    else if (Model.Status == 2 && Model.PaymentMethod != 1)
                    {
                        <label class="col-5 fw-bold text-primary">Pending Deposit</label>
                    }
                    else if (Model.Status == 2 && Model.PaymentMethod == 1)
                    {
                        <label class="col-5 fw-bold text-primary">Confirm</label>
                    }
                    else if(Model.Status==3)
                    {
                        <label class="col-5 fw-bold text-warning">In-progress</label>
                    }
                </div>
            </div>
            <div class="col-2 mt-3">
                <div>
                    <a style="width: 140px;" class="btn btn-primary p-2" asp-controller="Car" asp-action="ViewCarDetailsByCustomer" asp-route-location="@ViewBag.location" 
                    asp-route-startDate="@ViewBag.startDate" 
                    asp-route-endDate="@ViewBag.endDate" 
                    asp-route-CarId="@ViewBag.car.CarId">View details</a>
                </div>
                @if(Model.Status==2){
                    <div class="mt-3">
                    <button type="button" style="width: 140px;" class="btn btn-secondary p-2" data-bs-toggle="modal" data-bs-target="#confirm-pickup"data-bs-toggle="modal" data-bs-target="#confirm-pickup">
            Confirm Pick-up
        </button>
                </div>
                }
                @if (Model.Status == 3)
                {
                <div class="mt-3">
                    <a style="width: 140px;" class="btn btn-primary p-2" href="#">Return Car</a>
                </div>  
                }

                @if (Model.Status == 1||Model.Status == 2)
                {
                <div class="mt-3">
                    <a style="width: 140px;" class="btn btn-danger p-2" href="#">Cancel booking</a>
                </div>  
                }

            </div>
        </div>
        <div class="cont" id="step1">
            <div style="margin-left: 64px;">
                <div class="form-group" hidden>
                    <label asp-for="UserId" class="control-label"></label>
                    <input asp-for="UserId" class="form-control" value="@user.UserId" readonly>
                </div>
                <div class="form-group" hidden>
                    <label asp-for="CarId" class="control-label"></label>
                    <input asp-for="CarId" class="form-control" value="@ViewBag.carId" readonly>
                </div>
                <div class="form-group" hidden>
                    <label asp-for="Status" class="control-label"></label>
                    <input asp-for="Status" class="form-control" value="1" readonly/>
                    <span asp-validation-for="Status" class="text-danger"></span>
                </div>

                <input type="datetime" asp-for="StartDate" id="hiddenStartDate" class="form-control" value="@ViewBag.startDate" hidden/>
                <input type="datetime" asp-for="EndDate" id="hiddenEndDate" class="form-control" value="@ViewBag.endDate" hidden/>
            
                <div class="row text-myfont mt-2 pt-2">
                    <h4 class="mb-4">Renter's information</h4>
                    <div class="col-md-6">
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.RenterName" class="control-label">Full Name: <span style="color: red;">*</span></label>
                            <input asp-for="BookingInfo.RenterName" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.RenterName" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.RenterPhone" class="control-label">
                                Phone number: <span style="color: red;">*</span>
                            </label>
                        <input asp-for="BookingInfo.RenterPhone" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.RenterPhone" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.RenterNationalId" class="control-label">
                                National ID No: <span style="color: red;">*</span>
                            </label>
                        <input asp-for="BookingInfo.RenterNationalId" class="form-control" required />
                            <span asp-validation-for="BookingInfo.RenterNationalId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.RenterDob" class="control-label">Date of birth: <span style="color: red;">*</span></label>
                        <input asp-for="BookingInfo.RenterDob" class="form-control" type="date" required/>
                            <span asp-validation-for="BookingInfo.RenterDob" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <label asp-for="BookingInfo.RenterEmail" class="control-label">
                                Email address: <span style="color: red;">*</span>
                            </label>
                            <input asp-for="BookingInfo.RenterEmail" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.RenterEmail" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.RenterDrivingLicense" class="control-label">Driving license:</label>
                            <div class="input-group">
                                <input asp-for="BookingInfo.RenterDrivingLicense" type="file" id="fileInput" class="form-control" name="fileInput" style="display: none;" accept="image/*" />
                                <input asp-for="BookingInfo.RenterDrivingLicense" type="text" id="fileName" class="form-control" readonly />
                                <div class="input-group-append">
                                    <button asp-for="BookingInfo.RenterDrivingLicense" type="button" id="chooseFileBtn" class="btn btn-outline-secondary">Upload</button>
                                </div>
                            </div>
                            <span asp-validation-for="BookingInfo.RenterDrivingLicense" class="text-danger"></span>
                        </div>

                        <!-- Modal -->
                        <div class="modal fade" id="imageModal" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg" role="document">
                                <!-- Add modal-lg class -->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="imageModalLabel">Driving Lience</h5>
                                        <button type="button" class="close" id="closeModalBtn1" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <img id="modalImage" src="" style="width: 100%; height: auto;" /> <!-- Adjust styles -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <label asp-for="BookingInfo.RenterAddress.CityId" class="control-label mb-1">Address:</label>
                    <select asp-for="BookingInfo.RenterAddress.CityId" class="form-control form-select" asp-items="ViewBag.CitiesR">
                        <option value="">-- Select City --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.RenterAddress.CityId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <select asp-for="BookingInfo.RenterAddress.DistrictId" class="form-control form-select" asp-items="ViewBag.DistrictsR">
                        <option value="">-- Select District --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.RenterAddress.DistrictId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <select asp-for="BookingInfo.RenterAddress.WardId" class="form-control form-select" asp-items="ViewBag.WardsR">
                        <option value="">-- Select Ward --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.RenterAddress.WardId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                <input asp-for="BookingInfo.RenterAddress.HouseNumberStreet" class="form-control" value="@ViewBag.houseNumberStreetR" placeholder="House number, Street" />
                    <span asp-validation-for="BookingInfo.RenterAddress.HouseNumberStreet" class="text-danger"></span>
                </div>
                


                    @* --------------------driver's info------------------------ *@


                <div class="row text-myfont mt-2 pt-2">
                    <h4 class="mb-4">Driver's information</h4>
                    <div class="form-group mb-3">
                        <div class="checkbox">
                            <input id="isDifferentCheckbox" asp-for="BookingInfo.IsDifferent" /><span style="font-weight: 400;"> Different than Renter's information</span></input>
                            <span asp-validation-for="BookingInfo.IsDifferent" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.DriverName" class="control-label">Full Name: <span style="color: red;">*</span></label>
                            <input asp-for="BookingInfo.DriverName" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.DriverName" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.DriverPhone" class="control-label">
                                Phone number: <span style="color: red;">*</span>
                            </label>
                            <input asp-for="BookingInfo.DriverPhone" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.DriverPhone" class="text-danger"></span>
                        </div>

                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.DriverNationalId" class="control-label">
                                National ID No: <span style="color: red;">*</span>
                            </label>
                            <input asp-for="BookingInfo.DriverNationalId" class="form-control" required />
                            <span asp-validation-for="BookingInfo.DriverNationalId" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.DriverDob" class="control-label">Date of birth: <span style="color: red;">*</span></label>
                            <input asp-for="BookingInfo.DriverDob" class="form-control" type="date" required/>
                            <span asp-validation-for="BookingInfo.DriverDob" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <div asp-validation-summary="ModelOnly" class="text-danger"></div>
                            <label asp-for="BookingInfo.DriverEmail" class="control-label">
                                Email address: <span style="color: red;">*</span>
                            </label>
                            <input asp-for="BookingInfo.DriverEmail" class="form-control" required/>
                            <span asp-validation-for="BookingInfo.DriverEmail" class="text-danger"></span>
                        </div>
                        <div class="form-group col-md-8 mb-3">
                            <label asp-for="BookingInfo.DriverDrivingLicense" class="control-label">Driving license:</label>
                            <div class="input-group">
                                <input asp-for="BookingInfo.DriverDrivingLicense" type="file" id="fileInput2" class="form-control" name="fileInput2" style="display: none;" accept="image/*" />
                                <input asp-for="BookingInfo.DriverDrivingLicense" type="text" id="fileName2" class="form-control" readonly />
                                <div class="input-group-append">
                                    <button asp-for="BookingInfo.DriverDrivingLicense" type="button" id="chooseFileBtn2" class="btn btn-outline-secondary">Upload</button>
                                </div>
                            </div>
                            <span asp-validation-for="BookingInfo.DriverDrivingLicense" class="text-danger"></span>
                        </div>
                        <!-- Modal -->
                        <div class="modal fade" id="imageModal2" tabindex="-1" role="dialog" aria-labelledby="imageModalLabel" aria-hidden="true">
                            <div class="modal-dialog modal-lg" role="document">
                                <!-- Add modal-lg class -->
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="imageModalLabel2">Driving Lience</h5>
                                        <button type="button" class="close2" id="closeModalBtn2" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <img id="modalImage2" src="" style="width: 100%; height: auto;" /> <!-- Adjust styles -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <label asp-for="BookingInfo.DriverAddress.CityId" class="control-label mb-1">Address:</label>
                    <select asp-for="BookingInfo.DriverAddress.CityId" class="form-control form-select" asp-items="ViewBag.CitiesD">
                        <option value="">-- Select City --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.DriverAddress.CityId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <select asp-for="BookingInfo.DriverAddress.DistrictId" class="form-control form-select" asp-items="ViewBag.DistrictsD">
                        <option value="">-- Select District --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.DriverAddress.DistrictId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <select asp-for="BookingInfo.DriverAddress.WardId" class="form-control form-select" asp-items="ViewBag.WardsD">
                        <option value="">-- Select Ward --</option>
                    </select>
                    <span asp-validation-for="BookingInfo.DriverAddress.WardId" class="text-danger"></span>
                </div>
                <div class="form-group text-myfont col-md-6 mb-3">
                    <input asp-for="BookingInfo.DriverAddress.HouseNumberStreet" class="form-control" placeholder="House number, StreetD" />
                    <span asp-validation-for="BookingInfo.DriverAddress.HouseNumberStreet" class="text-danger"></span>
                </div>
                <div class="d-flex justify-content-center align-items-center mt-3">
                    <a asp-controller="Users" asp-action="LoginCus" type="button" class="btn btn-outline-secondary"
                        style="padding: 0;text-decoration: underline;border: none;">
                        Cancel
                    </a>
                    <button type="button" onclick="nextStep();" class="btn btn-primary ms-5">Next</button>
                </div>
            </div>
        </div>

        <div class="cont" id="step2">
            <div class="form-group">
                <div style="margin-left: 20px; margin-top: 10px;">
                    <p class="control-label"><strong>Please select your payment method</strong></p><br>
                </div>
                <div style="margin-left: 70px;">
                    @{
                        var wallet = ViewBag.wallet ?? 0;
                        var deposit = ViewBag.Deposit ?? 0;
                    }
                    <label>
                        <input id="pm1" type="radio" asp-for="@Model.PaymentMethod" value="1" checked/> My wallet<br>
                        <p>Current balance: <span style="color: yellowgreen;">@String.Format("{0:#,##0}", wallet) VND&nbsp;&nbsp;&nbsp;&nbsp;
                                @if(wallet < deposit)
                                {
                                    <span id="insufficient" style="color: yellowgreen;">insufficient</span>
                                }
                            </span></p>
                    </label>
                </div>

                <div style="margin-left: 70px;">
                    <label>
                        <input type="radio" asp-for="@Model.PaymentMethod" value="2" /> Cash<br>
                        <p>Our operator will contact you for further instruction</p>
                    </label>
                </div>

                <div style="margin-left: 70px;">
                    <label>
                        <input type="radio" asp-for="@Model.PaymentMethod" value="3" /> Bank transfer<br>
                        <p>Our operator will contact you for further instruction</p>
                    </label>
                </div>
                <span asp-validation-for="@Model.PaymentMethod" class="text-danger"></span>
            </div>
            <div class="form-group mt-2 row justify-content-center">
                <div class="d-flex justify-content-center align-items-center mt-3">
                    <a onclick="goToStep1();" type="button" class="btn btn-outline-secondary"
                        style="padding: 0;text-decoration: underline;border: none;">
                        Cancel
                    </a>
                    <button type="submit" onclick="nextStep();" class="btn btn-primary ms-5">Confirm payment</button>
                </div>
            </div>
        </div>
        <div class="cont mt-4" id="step3"></div>
    </form>
</div>

 <div class="modal" id="confirm-pickup">
            <div class="modal-dialog modal-dialog-centered modal-fullscreen-sm-down">
            <form asp-controller="Booking" asp-action="confirmPickupForDetailsPage" method="post">
                <div class="modal-content">

                    <!-- Modal body -->
                    <div class="modal-body rating-body">
                        <h6 class="text-center fw-bold text-danger w-100">
                            Are you sure you want to confirm pick-up?
                        </h6>

                        <input type="hidden" name="startDate" value="@ViewBag.startDate" />
                        <input type="hidden" name="endDate" value="@ViewBag.endDate" />
                        <input type="hidden" name="carId" value="@ViewBag.car.CarId" />
                        <input type="hidden" name="bookingNo" value="@Model.BookingNo" />

                    </div>
                    <!-- Modal footer -->
                    <div class="modal-footer " style="padding:0;">
                        <div class="d-flex w-100 justify-content-center align-items-center" style="margin:0">
                            <button type="button" data-bs-dismiss="modal" class="btn w-100 hover-shadow">No</button>
                            <div class="vr mx-1"></div>
                            <button type="submit" class="btn w-100 hover-shadow">Yes</button>
                        </div>
                    </div>
                </div>
            </form>

            </div>

    </div>



@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Hide all steps initially
        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'none';

        // Show the initial step (for example, Step 1)
        navigateTo(0); // Adjust index based on your steps (0-indexed)
    });

    function navigateTo(stepIndex) {
        // Hide all steps
        document.getElementById('step1').style.display = 'none';
        document.getElementById('step2').style.display = 'none';
        document.getElementById('step3').style.display = 'none';

        // Show the selected step
        document.getElementById('step' + (stepIndex + 1)).style.display = 'block';

        // Optionally, update the active state of your step indicators if needed
        const steps = document.querySelectorAll('.step');
        steps.forEach((step, index) => {
            if (index === stepIndex) {
                step.classList.add('active');
            } else {
                step.classList.remove('active');
            }
        });
    }

    function validateStep1() {
        const requiredFields = document.querySelectorAll('#step1 .form-control[required]');
        let valid = true;

        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                valid = false;
                field.classList.add('is-invalid');
            } else {
                field.classList.remove('is-invalid');
            }
        });

        // Check for any visible .text-danger elements
        const errorMessages = document.querySelectorAll('#step1 .text-danger');
        errorMessages.forEach(error => {
            if (error.innerHTML.trim() !== '') {
                valid = false;
            }
        });

        return valid;
    }

    // Function to navigate to the next step
    function nextStep() {
        // Validate Step 1 before proceeding to Step 2
        if (validateStep1()) {
            // Example: Navigate to Step 2
            navigateTo(1); // Adjust index based on your steps (0-indexed)
        } else {
            alert("Please fill in all required fields with valid values!");
        }
    }

    function goToStep1() {
        navigateTo(0); // Navigate to Step 1 (0-indexed)
    }
</script>




<script>
    $(document).ready(function () {
        // Fetch and populate districts when a city is selected
        $('#BookingInfo_RenterAddress_CityId').change(function () {
            var cityId = $(this).val();
            var districtSelect = $('#BookingInfo_RenterAddress_DistrictId');
            var wardSelect = $('#BookingInfo_RenterAddress_WardId');

            districtSelect.empty();
            wardSelect.empty();
            
            if (cityId) {
                $.getJSON('/Booking/GetDistricts', { cityId: cityId }, function (data) {
                    districtSelect.append('<option value="">-- Select District --</option>');
                    $.each(data, function (index, district) {
                        districtSelect.append('<option value="' + district.districtId + '">' + district.districtName + '</option>');
                    });
                });
            } else {
                districtSelect.append('<option value="">-- Select District --</option>');
            }
            wardSelect.append('<option value="">-- Select Ward --</option>');
        });

        // Fetch and populate wards when a district is selected
        $('#BookingInfo_RenterAddress_DistrictId').change(function () {
            var districtId = $(this).val();
            var wardSelect = $('#BookingInfo_RenterAddress_WardId');
            wardSelect.empty();

            if (districtId) {
                $.getJSON('/Booking/GetWards', { districtId: districtId }, function (data) {
                    wardSelect.append('<option value="">-- Select Ward --</option>');
                    $.each(data, function (index, ward) {
                        wardSelect.append('<option value="' + ward.wardId + '">' + ward.wardName + '</option>');
                    });
                });
            } else {
                wardSelect.append('<option value="">-- Select Ward --</option>');
            }
        });
    });
</script>

<script>
    $(document).ready(function () {
        // Fetch and populate districts when a city is selected
        $('#BookingInfo_DriverAddress_CityId').change(function () {
            var cityId = $(this).val();
            var districtSelect = $('#BookingInfo_DriverAddress_DistrictId');
            var wardSelect = $('#BookingInfo_DriverAddress_WardId');

            districtSelect.empty();
            wardSelect.empty();
            
            if (cityId) {
                $.getJSON('/Booking/GetDistricts', { cityId: cityId }, function (data) {
                    districtSelect.append('<option value="">-- Select District --</option>');
                    $.each(data, function (index, district) {
                        districtSelect.append('<option value="' + district.districtId + '">' + district.districtName + '</option>');
                    });
                });
            } else {
                districtSelect.append('<option value="">-- Select District --</option>');
            }
            wardSelect.append('<option value="">-- Select Ward --</option>');
        });

        // Fetch and populate wards when a district is selected
        $('#BookingInfo_DriverAddress_DistrictId').change(function () {
            var districtId = $(this).val();
            var wardSelect = $('#BookingInfo_DriverAddress_WardId');
            wardSelect.empty();

            if (districtId) {
                $.getJSON('/Booking/GetWards', { districtId: districtId }, function (data) {
                    wardSelect.append('<option value="">-- Select Ward --</option>');
                    $.each(data, function (index, ward) {
                        wardSelect.append('<option value="' + ward.wardId + '">' + ward.wardName + '</option>');
                    });
                });
            } else {
                wardSelect.append('<option value="">-- Select Ward --</option>');
            }
        });
    });
</script>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
    const chooseFileBtn = document.getElementById('chooseFileBtn');
    const fileInput = document.getElementById('fileInput');
    const fileNameInput = document.getElementById('fileName');
    const modalImage = document.getElementById('modalImage');
    const defaultImage = '@Url.Content("~/img/" + Model?.BookingInfo?.RenterDrivingLicense)'; // Ensure correct path

    chooseFileBtn.addEventListener('click', function () {
        fileInput.click(); // Simulate click on file input
    });

    fileInput.addEventListener('change', function () {
        const file = this.files[0]; // Get the selected file
        if (file) {
            fileNameInput.value = file.name; // Display file name
            showImagePreview(file); // Show preview of selected file
        } else {
            fileNameInput.value = ''; // Clear file name if no file selected
            showDefaultImage(); // Show default image when no file selected
        }
    });

    fileNameInput.addEventListener('click', function () {
        const file = fileInput.files[0];
        if (file) {
            showImagePreview(file); // Show preview of selected file
        } else {
            showDefaultImage(); // Show default image when no file selected
        }
    });

    function showImagePreview(file) {
        const reader = new FileReader();
        reader.onload = function () {
            modalImage.src = reader.result;
            $('#imageModal').modal('show'); // Show the modal with the image
        };
        reader.readAsDataURL(file);
    }

    const closeModalBtn = document.getElementById('closeModalBtn1'); // Get the close button element
    closeModalBtn.addEventListener('click', function () {
        $('#imageModal').modal('hide'); // Hide the modal
    });

    // Conditionally define the showDefaultImage function
    @if (ViewBag.DrivingLience != null) {
        <text>
        function showDefaultImage() {
            modalImage.src = defaultImage;
            $('#imageModal').modal('show'); // Show the modal with the default image
        }
        </text>
    } else {
        <text>
        function showDefaultImage() {
            // No action if there's no default image
        }
        </text>
    }
});
</script>
<script>
    $(document).ready(function () {
    const fileInput = document.getElementById('fileInput');

    fileInput.addEventListener('change', function () {
        const file = this.files[0]; // Get the selected file
        if (file) {
            uploadFile(file); // Call function to upload file
        }
    });

    function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);

        $.ajax({
            url: '/Booking/UploadImage', // Replace with your controller method to handle file upload
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('File uploaded successfully');
                // Optionally update UI or handle success
            },
            error: function () {
                console.log('Error uploading file');
                // Handle error if needed
            }
        });
    }
});
</script>
@* ------------------------------------------- *@
<script>
    document.addEventListener('DOMContentLoaded', function () {
    const chooseFileBtn = document.getElementById('chooseFileBtn2');
    const fileInput = document.getElementById('fileInput2');
    const fileNameInput = document.getElementById('fileName2');
    const modalImage = document.getElementById('modalImage2');
    // const defaultImage = '@Url.Content("~/img/" + ViewBag.DrivingLience)';


    chooseFileBtn.addEventListener('click', function () {
        fileInput.click(); // Simulate click on file input
    });

    fileInput.addEventListener('change', function () {
        const file = this.files[0]; // Get the selected file
        if (file) {
            fileNameInput.value = file.name; // Display file name
            showImagePreview(file); // Show preview of selected file
        } else {
            fileNameInput.value = ''; // Clear file name if no file selected
            showDefaultImage(); // Show default image when no file selected
        }
    });

    fileNameInput.addEventListener('click', function () {
        const file = fileInput.files[0];
        if (file) {
            showImagePreview(file); // Show preview of selected file
        } else {
            showDefaultImage(); // Show default image when no file selected
        }
    });

    function showImagePreview(file) {
        const reader = new FileReader();
        reader.onload = function () {
            modalImage.src = reader.result;
            $('#imageModal2').modal('show'); // Show the modal with the image
        };
        reader.readAsDataURL(file);
    }

    const closeModalBtn = document.getElementById('closeModalBtn2'); // Get the close button element
    closeModalBtn.addEventListener('click', function () {
        $('#imageModal2').modal('hide'); // Hide the modal
    });

    // Conditionally define the showDefaultImage function
    function showDefaultImage() {
        var isDifferent = document.getElementById('isDifferentCheckbox').checked;
        if (!isDifferent) {
            if (fileNameInput.value && !fileInput.files[0]) {
            alert('The same file with renter driving lience.');
        }
        } else {
            // No action if there's no default image
        }

        $('input[name="BookingInfo.IsDifferent"]').change(function () {
            if ($(this).is(':checked')) {
                // Assuming `fileInput` is your file input element
                fileInput.value = ''; // Clear the value of the file input
            }
        });
    }

    // Call showDefaultImage() function when the checkbox state changes
    // document.getElementById('isDifferentCheckbox').addEventListener('change', showDefaultImage);
});
</script>
<script>
    $(document).ready(function () {
    const fileInput = document.getElementById('fileInput2');

    fileInput.addEventListener('change', function () {
        const file = this.files[0]; // Get the selected file
        if (file) {
            uploadFile(file); // Call function to upload file
        }
    });

    function uploadFile(file) {
        const formData = new FormData();
        formData.append('file', file);

        $.ajax({
            url: '/Booking/UploadImage', // Replace with your controller method to handle file upload
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (data) {
                console.log('File uploaded successfully');
                // Optionally update UI or handle success
            },
            error: function () {
                console.log('Error uploading file');
                // Handle error if needed
            }
        });
    }
});
</script>

     


     <script>
    function setRating(rating) {
        const stars = document.querySelectorAll('#rating .star');
        stars.forEach((star, index) => {
            star.classList.remove('filled', 'half-filled');
            if (rating >= index + 1) {
                star.classList.add('filled');
            } else if (rating > index && rating < index + 1) {
                star.classList.add('half-filled');
            }
        });
    }

    // Example rating
    setRating(3.5);
</script>


    <script>
    $(document).ready(function () {
        $('#changeDetailsLink').click(function (e) {
            e.preventDefault();
            $('#editBookingModal').modal('toggle');
        });

        $('#closeModalBtn, #closeModal').click(function () {
            $('#editBookingModal').modal('hide');
        });

        $('#saveChangesBtn').click(function () {
            var newLocation = $('#modalPickupLocation').val();
            var newStartDate = $('#modalStartDate').val();
            var newEndDate = $('#modalEndDate').val();
            var newCarId = $('#modalCarId').val();

            // Validate start date and time is greater than current date and time
            if (!isStartDateGreaterThanCurrentDate(newStartDate)) {
                alert('Start date and time must be greater than the current date and time.');
                return;
            }

            // Validate end date and time is greater than start date and time
            if (!isEndDateGreaterThanStartDate(newStartDate, newEndDate)) {
                alert('End date and time must be greater than start date and time.');
                return;
            }

            // Format dates to desired format
            var formattedStartDate = formatDate(newStartDate);
            var formattedEndDate = formatDate(newEndDate);

            // Update booking details display
            $('#pickupLocationText').text(newLocation);
            $('#startDateText').text(formattedStartDate);
            $('#endDateText').text(formattedEndDate);
            $('#CarIdText').text(newCarId);

            // Optionally update hidden input values
            $('#hiddenStartDate').val(newStartDate);
            $('#hiddenEndDate').val(newEndDate);

            // Construct the URL with updated parameters
            var newUrl = window.location.protocol + "//" + window.location.host + window.location.pathname +
                '?location=' + encodeURIComponent(newLocation) +
                '&startDate=' + encodeURIComponent(newStartDate) +
                '&endDate=' + encodeURIComponent(newEndDate) +
                '&CarId=' + encodeURIComponent(newCarId);

            // Redirect to the new URL
            window.location.href = newUrl;
        });

        // Function to format date to dd/MM/yyyy - HH:mm tt
        function formatDate(dateString) {
            var date = new Date(dateString);
            var formattedDate = date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            });

            // Ensure "AM" or "PM" is in uppercase
            formattedDate = formattedDate.replace(/\b([ap])m\b/g, function (match) {
                return match.toUpperCase();
            });

            return formattedDate;
        }

        // Function to check if start date and time is greater than current date and time
        function isStartDateGreaterThanCurrentDate(startDate) {
            var startDateTime = new Date(startDate).getTime();
            var currentDateTime = new Date().getTime();

            return startDateTime > currentDateTime;
        }

        // Function to check if end date and time is greater than start date and time
        function isEndDateGreaterThanStartDate(startDate, endDate) {
            var startDateTime = new Date(startDate).getTime();
            var endDateTime = new Date(endDate).getTime();

            return endDateTime > startDateTime;
        }
    });
</script>


    <script>
    $(document).ready(function () {
    // Lưu trữ tùy chọn ban đầu của dropdown
    var originalDistrictOptions = $('#BookingInfo_RenterAddress_DistrictId').html();
    var originalWardOptions = $('#BookingInfo_RenterAddress_WardId').html();

    // Initially hide driver's information fields
    toggleDriverFields();

    // Toggle driver's information fields based on checkbox state
    $('input[name="BookingInfo.IsDifferent"]').change(function () {
        toggleDriverFields();
    });

    function toggleDriverFields() {
        var isChecked = $('input[name="BookingInfo.IsDifferent"]').is(':checked');

        // Kiểm tra xem checkbox có thuộc tính data-first-load không
        var isFirstLoad = $('input[name="BookingInfo.IsDifferent"]').data('first-load');

        if (isFirstLoad !== 'done') {
            // Đánh dấu lần đầu đã hoàn thành
            $('input[name="BookingInfo.IsDifferent"]').data('first-load', 'done');
            return; // Không làm gì nếu là lần đầu
        }

        if (isChecked) {
            // Clear driver's information fields
            $('#BookingInfo_DriverName').val('');
            $('#BookingInfo_DriverPhone').val('');
            $('#BookingInfo_DriverNationalId').val('');
            $('#BookingInfo_DriverDob').val('');
            $('#BookingInfo_DriverEmail').val('');
            $('#fileName2').val('');
            $('#BookingInfo_DriverAddress_CityId').val('');
            $('#BookingInfo_DriverAddress_DistrictId').val('').find('option:not(:first)').remove(); // Clear DistrictId dropdown options
            $('#BookingInfo_DriverAddress_WardId').val('').find('option:not(:first)').remove(); // Clear WardId dropdown options
            $('#BookingInfo_DriverAddress_HouseNumberStreet').val('');
        } else {
            // Copy renter's information to driver's information fields
            $('#BookingInfo_DriverAddress_DistrictId').html(originalDistrictOptions);
            $('#BookingInfo_DriverAddress_WardId').html(originalWardOptions);
            $('#BookingInfo_DriverName').val($('#BookingInfo_RenterName').val());
            $('#BookingInfo_DriverPhone').val($('#BookingInfo_RenterPhone').val());
            $('#BookingInfo_DriverNationalId').val($('#BookingInfo_RenterNationalId').val());
            $('#BookingInfo_DriverDob').val($('#BookingInfo_RenterDob').val());
            $('#BookingInfo_DriverEmail').val($('#BookingInfo_RenterEmail').val());
            $('#fileName2').val($('#fileName').val());
            $('#BookingInfo_DriverAddress_CityId').val($('#BookingInfo_RenterAddress_CityId').val());
            $('#BookingInfo_DriverAddress_DistrictId').val($('#BookingInfo_RenterAddress_DistrictId').val());
            $('#BookingInfo_DriverAddress_WardId').val($('#BookingInfo_RenterAddress_WardId').val());
            $('#BookingInfo_DriverAddress_HouseNumberStreet').val($('#BookingInfo_RenterAddress_HouseNumberStreet').val());
        }
    }
});
</script>

<script>
    document.getElementById('Form').addEventListener('submit', function(event) {
        var insufficientBalance = document.getElementById('insufficient');
        var pm1 = document.getElementById('pm1').checked; // Check if the radio button is checked
        var wallet = @Html.Raw(Json.Serialize(ViewBag.wallet)); // Retrieve wallet balance from ViewBag
        var deposit = @Html.Raw(Json.Serialize(ViewBag.Deposit)); // Retrieve deposit from ViewBag

        if (pm1 && wallet < deposit) {
            alert("Insufficient balance. Please add more funds to your wallet.");
            event.preventDefault(); // Prevent the form from being submitted
        }
    });
</script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
        function showImageAndDownload(imagePath, fileName) {
            document.getElementById('modalImage').src = imagePath;
            document.getElementById('downloadLink').href = imagePath;
            document.getElementById('downloadLink').download = fileName;
            $('#imageModal').modal('show');
        }
    </script>
}